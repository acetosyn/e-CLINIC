{% extends "base.html" %}
{% block title %}Customer Care â€” Epiconsult e-Clinic{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/customer_care.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/newpatient.css') }}">

{% endblock %}

{% block content %}

<!-- ===========================================================
     CUSTOMER CARE DASHBOARD â€” GRID + MODAL SYSTEM
=========================================================== -->
<div class="cc-wrapper fadeIn">

  <!-- ===== PAGE HEADER ===== -->
  <div class="cc-page-header">
    <div>
      <h2 class="cc-title">
        <i class="fa-solid fa-headset"></i> Customer Care Desk
      </h2>
      <p class="cc-subtitle">
        Smart frontline intake â€¢ Dynamic tools â€¢ Real-time departmental tracking
      </p>
    </div>

    <div class="cc-header-actions">
      <button class="cc-btn outline" id="viewLiveTracking">
        <i class="fa-solid fa-bullseye"></i> Live Tracking
      </button>
      <button class="cc-btn ghost" id="viewSummary">
        <i class="fa-solid fa-chart-line"></i> Summary Overview
      </button>
    </div>
  </div>

  <!-- ===== MAIN GRID MENU ===== -->
  <div class="cc-grid-menu">
    <div class="cc-tile" data-target="modalNewPatient">

      <i class="fa-solid fa-user-plus"></i>
      <h3>New Patient</h3>
      <p>Register new patients quickly with full details.</p>
    </div>

    <div class="cc-tile" data-target="modalRecords">
      <i class="fa-solid fa-folder-open"></i>
      <h3>Patient Records</h3>
      <p>Search, view, or update existing patient information.</p>
    </div>

    <div class="cc-tile" data-target="modalFollowUps">
      <i class="fa-solid fa-repeat"></i>
      <h3>Follow-Ups</h3>
      <p>Manage returning patients and scheduled revisits.</p>
    </div>

    <div class="cc-tile" data-target="modalInvoices">
      <i class="fa-solid fa-file-invoice"></i>
      <h3>Invoices / Billing</h3>
      <p>Track payments and send invoices to Accounts.</p>
    </div>

    <div class="cc-tile" data-target="modalLab">
      <i class="fa-solid fa-vial"></i>
      <h3>Lab Requests</h3>
      <p>Manage and send laboratory-related cases.</p>
    </div>

    <div class="cc-tile" data-target="modalDiagnostics">
      <i class="fa-solid fa-x-ray"></i>
      <h3>Diagnostics</h3>
      <p>Forward patients for imaging or scan diagnostics.</p>
    </div>

    <div class="cc-tile" data-target="modalMessages">
      <i class="fa-solid fa-paper-plane"></i>
      <h3>Department Messages</h3>
      <p>Send notifications or forward cases between departments.</p>
    </div>

    <div class="cc-tile" data-target="modalReports">
      <i class="fa-solid fa-file-waveform"></i>
      <h3>Daily Report</h3>
      <p>Generate and submit daily summaries to HOP/Operations.</p>
    </div>
  </div>

  <!-- ===== LIVE SIDEBAR ===== -->
  <div class="cc-live-panel">
    <div class="cc-card">
      <h3><i class="fa-solid fa-bell"></i> Live Activity</h3>
      <ul id="liveActivityFeed">
        <li class="muted">No activity yet â€” actions will appear here.</li>
      </ul>
    </div>
    <div class="cc-card">
      <h3><i class="fa-solid fa-chart-simple"></i> Quick Stats</h3>
      <div class="cc-stats-summary">
        <p><strong>New Patients:</strong> <span id="statPatients">0</span></p>
        <p><strong>Sent to Accounts:</strong> <span id="statAccounts">0</span></p>
        <p><strong>Follow Ups:</strong> <span id="statFollowups">0</span></p>
      </div>
    </div>
  </div>
</div>

<!-- ===========================================================
     MODALS
=========================================================== -->

<!-- ðŸ”¹ New Patient -->
<div class="cc-modal" id="modalNewPatient">
  <div class="cc-modal-content wide">
    <div class="cc-modal-header">
      <h3><i class="fa-solid fa-user-plus"></i> New Patient Registration</h3>
      <button class="cc-modal-close" data-close-modal="#modalNewPatient">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>
    <div class="cc-modal-body">
<div id="newPatientContent">
  <form id="newPatientForm" class="cc-form">
    <div class="cc-row">
      <div class="cc-field">
        <label>Date Registered</label>
        <input type="date" id="dateRegistered" name="dateRegistered" required>
      </div>

      <div class="cc-field">
        <label>File No</label>
        <input type="text" id="fileNo" name="fileNo" readonly placeholder="Auto-generated">
      </div>

      <div class="cc-field">
        <label>Patient ID</label>
        <input type="text" id="patientId" name="patientId" readonly placeholder="EPN-XXXX">
      </div>
    </div>

    <div class="cc-row">
      <div class="cc-field">
        <label>Full Name</label>
        <input type="text" name="fullName" required placeholder="Enter full name">
      </div>

      <div class="cc-field">
        <label>Date of Birth</label>
        <input type="date" id="dob" name="dob">
      </div>

      <div class="cc-field">
        <label>Age</label>
        <input type="number" id="age" name="age" readonly placeholder="Auto-calculated">
      </div>
    </div>

    <div class="cc-row">
      <div class="cc-field">
        <label>Email</label>
        <input type="email" name="email" placeholder="e.g. patient@email.com">
      </div>

      <div class="cc-field">
        <label>Phone Number</label>
        <input type="tel" name="phone" placeholder="e.g. 08012345678">
      </div>

      <div class="cc-field">
        <label>Gender</label>
        <select name="gender" required>
          <option value="">Select</option>
          <option>Male</option>
          <option>Female</option>
        </select>
      </div>
    </div>

    <div class="cc-section-divider">Next of Kin Details</div>

    <div class="cc-row">
      <div class="cc-field">
        <label>Next of Kin Name</label>
        <input type="text" name="nokName" placeholder="Full name">
      </div>

      <div class="cc-field">
        <label>Next of Kin Phone</label>
        <input type="tel" name="nokPhone" placeholder="e.g. 08023456789">
      </div>

      <div class="cc-field">
        <label>Next of Kin Email</label>
        <input type="email" name="nokEmail" placeholder="e.g. kin@email.com">
      </div>
    </div>

    <div class="cc-section-divider">Delivery Mode & Service</div>

    <div class="cc-row">
      <div class="cc-field">
        <label>Delivery Preference</label>
        <select name="deliveryMode" required>
          <option value="">Select Mode</option>
          <option>WhatsApp</option>
          <option>Email</option>
          <option>Print</option>
        </select>
      </div>

      <div class="cc-field">
        <label>Service Type</label>
        <select name="service" required>
          <option value="">Select Service</option>
           <option>General Services</option>
          <option>Consultation only</option>
          <option>Laboratory Test</option>
          <option>Diagnostics Test</option>
          <option>Drugs & Pharmacy</option>
          <option>Follow-up</option>
        </select>
      </div>

      <div class="cc-field">
        <label>Additional Notes</label>
        <textarea name="notes" rows="2" placeholder="Optional notes..."></textarea>
      </div>
    </div>

    <div class="cc-section-divider">Summary</div>
    <div id="liveSummary" class="cc-card" style="background:#f9fafb;padding:1rem;">
      <p class="muted">Patient summary will appear here after registration.</p>
    </div>

    <div class="cc-form-actions">
      <button type="submit" class="cc-btn primary">
        <i class="fa-solid fa-floppy-disk"></i> Save Record
      </button>
      <button type="reset" class="cc-btn outline">
        <i class="fa-solid fa-rotate"></i> Reset
      </button>
    </div>
  </form>
</div>

    </div>
  </div>
</div>

<!-- ðŸ”¹ Patient Records -->
<div class="cc-modal" id="modalRecords">
  <div class="cc-modal-content wide">
    <div class="cc-modal-header">
      <h3><i class="fa-solid fa-folder-open"></i> Patient Records</h3>
      <button class="cc-modal-close" data-close-modal="#modalRecords">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>
    <div class="cc-modal-body">
      <div id="recordsContent" class="cc-modal-placeholder">
        <p>Loading records module...</p>
      </div>
    </div>
  </div>
</div>

<!-- ðŸ”¹ Follow Ups -->
<div class="cc-modal" id="modalFollowUps">
  <div class="cc-modal-content">
    <div class="cc-modal-header">
      <h3><i class="fa-solid fa-repeat"></i> Follow-Ups</h3>
      <button class="cc-modal-close" data-close-modal="#modalFollowUps">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>
    <div class="cc-modal-body">
      <div id="followUpContent" class="cc-modal-placeholder">
        <p>Follow-up patient list will appear here.</p>
      </div>
    </div>
  </div>
</div>

<!-- ðŸ”¹ Invoices / Billing -->
<div class="cc-modal" id="modalInvoices">
  <div class="cc-modal-content">
    <div class="cc-modal-header">
      <h3><i class="fa-solid fa-file-invoice"></i> Invoices & Billing</h3>
      <button class="cc-modal-close" data-close-modal="#modalInvoices">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>
    <div class="cc-modal-body">
      <p>All invoices handled and sent to Accounts will display here.</p>
    </div>
  </div>
</div>

<!-- ðŸ”¹ Lab Requests -->
<div class="cc-modal" id="modalLab">
  <div class="cc-modal-content">
    <div class="cc-modal-header">
      <h3><i class="fa-solid fa-vial"></i> Laboratory Requests</h3>
      <button class="cc-modal-close" data-close-modal="#modalLab">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>
    <div class="cc-modal-body">
      <p>Manage lab-related routing and results for patients.</p>
    </div>
  </div>
</div>

<!-- ðŸ”¹ Diagnostics -->
<div class="cc-modal" id="modalDiagnostics">
  <div class="cc-modal-content">
    <div class="cc-modal-header">
      <h3><i class="fa-solid fa-x-ray"></i> Diagnostics Requests</h3>
      <button class="cc-modal-close" data-close-modal="#modalDiagnostics">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>
    <div class="cc-modal-body">
      <p>Send and track diagnostic referrals from this section.</p>
    </div>
  </div>
</div>

<!-- ðŸ”¹ Department Messages -->
<div class="cc-modal" id="modalMessages">
  <div class="cc-modal-content">
    <div class="cc-modal-header">
      <h3><i class="fa-solid fa-paper-plane"></i> Department Messages</h3>
      <button class="cc-modal-close" data-close-modal="#modalMessages">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>
    <div class="cc-modal-body">
      <p>Send inter-department messages or patient notifications.</p>
    </div>
  </div>
</div>

<!-- ðŸ”¹ Reports -->
<div class="cc-modal" id="modalReports">
  <div class="cc-modal-content wide">
    <div class="cc-modal-header">
      <h3><i class="fa-solid fa-file-waveform"></i> Daily Reports</h3>
      <button class="cc-modal-close" data-close-modal="#modalReports">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>
    <div class="cc-modal-body">
      <p>Generate or review daily department reports.</p>
    </div>
  </div>
</div>

<!-- Toast Notification -->
<div id="ccToast" class="cc-toast"></div>

{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/customer_care.js') }}"></script>
<script src="{{ url_for('static', filename='js/customer_care.js') }}"></script>
<script src="{{ url_for('static', filename='js/customer_care_newpatient.js') }}"></script>
{% endblock %}
